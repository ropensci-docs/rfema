<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rfema">
<title>rfema: Getting Started • rfema</title>
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://docs.ropensci.org/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="rfema: Getting Started">
<meta property="og:description" content="rfema">
<meta property="og:image" content="https://docs.ropensci.org/rfema/logo.png">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">rfema</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/getting_started.html">rfema: Getting Started</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/dylan-turner25/rfema/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>rfema: Getting Started</h1>
                        <h4 data-toc-skip class="author">Dylan Turner</h4>
            
            <h4 data-toc-skip class="date">2023-11-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/dylan-turner25/rfema/blob/HEAD/vignettes/getting_started.Rmd" class="external-link"><code>vignettes/getting_started.Rmd</code></a></small>
      <div class="d-none name"><code>getting_started.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette provides a brief overview on using the <code>rfema</code> package to obtain data from the Open FEMA API. The rest of this vignette covers how to install the package, followed by examples on using the package to obtain data for various objectives.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Right now, the best way to install and use the <code>rfema</code> package is by installing directly from rOpenSci using <code>install.packages("rfema", repos = "https://ropensci.r-universe.dev")</code>. The FEMA API does not require and API key, meaning no further setup steps need be taken to start using the package</p>
</div>
<div class="section level2">
<h2 id="available-datasets">Available Datasets<a class="anchor" aria-label="anchor" href="#available-datasets"></a>
</h2>
<p>For those unfamiliar with the data sets available through the FEMA API, a good starting place is to visit the <a href="https://www.fema.gov/about/openfema/data-sets" class="external-link">FEMA API documentation page</a>. However, if you are already familiar with the data and want to quickly reference the data set names or another piece of meta data, using the <code><a href="../reference/fema_data_sets.html">fema_data_sets()</a></code> function to obtain a tibble of available data sets along with associated meta data is a convenient option.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># store the avaliable data sets as an object in your R environment that can be referenced later</span></span>
<span><span class="va">data_sets</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fema_data_sets.html">fema_data_sets</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># view data </span></span>
<span><span class="va">data_sets</span></span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 51 × 35</span></span>
<span><span class="co">##    identifier  name     title descr…¹ webSe…² dataD…³ keyword modif…⁴ publi…⁵ conta…⁶ mbox  acces…⁷</span></span>
<span><span class="co">##    &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;list&gt;  &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;  </span></span>
<span><span class="co">##  1 openfema-53 Registr… Regi… "This … https:… https:… &lt;list&gt;  2023-0… Federa… OpenFE… open… public </span></span>
<span><span class="co">##  2 openfema-68 NfipCom… NFIP… "This … https:… https:… &lt;list&gt;  2023-0… Federa… OpenFE… open… public </span></span>
<span><span class="co">##  3 openfema-14 Registr… Regi… "This … https:… https:… &lt;list&gt;  2023-1… Federa… OpenFE… open… public </span></span>
<span><span class="co">##  4 openfema-45 HazardM… Haza… "The d… https:… https:… &lt;list&gt;  2023-1… Federa… OpenFE… open… public </span></span>
<span><span class="co">##  5 openfema-54 Housing… Hous… "This … https:… https:… &lt;list&gt;  2023-0… Federa… OpenFE… open… public </span></span>
<span><span class="co">##  6 openfema-55 Housing… Hous… "The d… https:… https:… &lt;list&gt;  2023-0… Federa… OpenFE… open… public </span></span>
<span><span class="co">##  7 openfema-34 Individ… Indi… "This … https:… https:… &lt;list&gt;  2020-0… Federa… OpenFE… open… public </span></span>
<span><span class="co">##  8 openfema-24 FemaWeb… FEMA… "This … https:… https:… &lt;list&gt;  2023-0… Federa… OpenFE… open… public </span></span>
<span><span class="co">##  9 openfema-33 Mission… Miss… "1.1 W… https:… https:… &lt;list&gt;  2023-0… Federa… OpenFE… open… public </span></span>
<span><span class="co">## 10 openfema-25 FemaWeb… FEMA… "This … https:… https:… &lt;list&gt;  2023-0… Federa… OpenFE… open… public </span></span>
<span><span class="co">## # … with 41 more rows, 23 more variables: landingPage &lt;list&gt;, temporal &lt;list&gt;, api &lt;lgl&gt;,</span></span>
<span><span class="co">## #   version &lt;int&gt;, bureauCode &lt;chr&gt;, programCode &lt;chr&gt;, license &lt;list&gt;, theme &lt;list&gt;,</span></span>
<span><span class="co">## #   dataQuality &lt;chr&gt;, accrualPeriodicity &lt;list&gt;, language &lt;chr&gt;, references &lt;list&gt;,</span></span>
<span><span class="co">## #   issued &lt;list&gt;, recordCount &lt;list&gt;, depDate &lt;list&gt;, depApiMessage &lt;list&gt;, depWebMessage &lt;list&gt;,</span></span>
<span><span class="co">## #   depNewURL &lt;list&gt;, hash &lt;chr&gt;, lastRefresh &lt;chr&gt;, id &lt;chr&gt;, lastDataSetRefresh &lt;list&gt;,</span></span>
<span><span class="co">## #   distribution &lt;list&gt;, and abbreviated variable names ¹​description, ²​webService,</span></span>
<span><span class="co">## #   ³​dataDictionary, ⁴​modified, ⁵​publisher, ⁶​contactPoint, ⁷​accessLevel</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print out just the names of the avaliable data sets without all the other meta data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">data_sets</span><span class="op">$</span><span class="va">title</span>, sep <span class="op">=</span> <span class="st">", "</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "Registration Intake and Individuals Household Program (RI-IHP)"</span></span>
<span><span class="co">##  [2] "NFIP Community Assistance Visits"                              </span></span>
<span><span class="co">##  [3] "Registration Intake and Individuals Household Program (RI-IHP)"</span></span>
<span><span class="co">##  [4] "Hazard Mitigation Assistance Projects"                         </span></span>
<span><span class="co">##  [5] "Housing Assistance Program Data - Owners"                      </span></span>
<span><span class="co">##  [6] "Housing Assistance Program Data - Renters"                     </span></span>
<span><span class="co">##  [7] "Individuals and Households Program - Valid Registrations"      </span></span>
<span><span class="co">##  [8] "FEMA Web Disaster Summaries"                                   </span></span>
<span><span class="co">##  [9] "Mission Assignments"                                           </span></span>
<span><span class="co">## [10] "FEMA Web Disaster Declarations"                                </span></span>
<span><span class="co">## [11] "Disaster Declarations Summaries"                               </span></span>
<span><span class="co">## [12] "OpenFEMA Data Set Fields"                                      </span></span>
<span><span class="co">## [13] "Disaster Declarations Summaries"                               </span></span>
<span><span class="co">## [14] "Hazard Mitigation Grant Program - Property Acquisitions"       </span></span>
<span><span class="co">## [15] "FEMA Web Declaration Areas"                                    </span></span>
<span><span class="co">## [16] "Housing Assistance Program Data - Renters"                     </span></span>
<span><span class="co">## [17] "IPAWS Archived Alerts"                                         </span></span>
<span><span class="co">## [18] "Hazard Mitigation Assistance Projects"                         </span></span>
<span><span class="co">## [19] "FIMA NFIP Redacted Claims"                                     </span></span>
<span><span class="co">## [20] "FIMA NFIP Redacted Claims"                                     </span></span>
<span><span class="co">## [21] "Emergency Management Performance Grants"                       </span></span>
<span><span class="co">## [22] "FEMA Regions"                                                  </span></span>
<span><span class="co">## [23] "Emergency Management Performance Grants"                       </span></span>
<span><span class="co">## [24] "Non-Disaster and Assistance to Firefighter Grants"             </span></span>
<span><span class="co">## [25] "Hazard Mitigation Assistance Mitigated Properties"             </span></span>
<span><span class="co">## [26] "Hazard Mitigation Grant Program - Disaster Summaries"          </span></span>
<span><span class="co">## [27] "FEMA Regions"                                                  </span></span>
<span><span class="co">## [28] "Hazard Mitigation Assistance Mitigated Properties"             </span></span>
<span><span class="co">## [29] "Individual Assistance Housing Registrants - Large Disasters"   </span></span>
<span><span class="co">## [30] "HMA Subapplications Project Site Inventories"                  </span></span>
<span><span class="co">## [31] "HMA Subapplications"                                           </span></span>
<span><span class="co">## [32] "FIMA NFIP Redacted Policies"                                   </span></span>
<span><span class="co">## [33] "HMA Subapplications By NFIP CRS Communities"                   </span></span>
<span><span class="co">## [34] "Hazard Mitigation Grants"                                      </span></span>
<span><span class="co">## [35] "Housing Assistance Program Data - Owners"                      </span></span>
<span><span class="co">## [36] "NFIP Community Engagements"                                    </span></span>
<span><span class="co">## [37] "FIMA NFIP Redacted Policies"                                   </span></span>
<span><span class="co">## [38] "OpenFEMA Data Sets"                                            </span></span>
<span><span class="co">## [39] "Public Assistance Applicants"                                  </span></span>
<span><span class="co">## [40] "Hazard Mitigation Assistance Mitigated Properties"             </span></span>
<span><span class="co">## [41] "Declaration Denials"                                           </span></span>
<span><span class="co">## [42] "Hazard Mitigation Plan Statuses"                               </span></span>
<span><span class="co">## [43] "NFIP Community Assistance Contacts"                            </span></span>
<span><span class="co">## [44] "Public Assistance Funded Projects Details"                     </span></span>
<span><span class="co">## [45] "Public Assistance Funded Project Summaries"                    </span></span>
<span><span class="co">## [46] "Public Assistance Grant Award Activities"                      </span></span>
<span><span class="co">## [47] "Hazard Mitigation Assistance Projects"                         </span></span>
<span><span class="co">## [48] "Hazard Mitigation Grant Program - Disaster Summaries"          </span></span>
<span><span class="co">## [49] "Public Assistance Applicants Program Deliveries"               </span></span>
<span><span class="co">## [50] "Hazard Mitigation Assistance Projects by NFIP CRS Communities" </span></span>
<span><span class="co">## [51] "NFIP Community Status Book"</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="example-workflow">Example Workflow<a class="anchor" aria-label="anchor" href="#example-workflow"></a>
</h2>
<p>Once we know what data set we want to access, or perhaps if we want to know more about what data is available in a given data set, we can use the <code><a href="../reference/fema_data_fields.html">fema_data_fields()</a></code> function to get a look at the available data fields in a given data set by setting the “data_set” parameter to one of the “name” columns in the data frame returned by the <code><a href="../reference/fema_data_sets.html">fema_data_sets()</a></code> function.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># obtain all the data fields for the NFIP Policies data set</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fema_data_fields.html">fema_data_fields</a></span><span class="op">(</span>data_set <span class="op">=</span> <span class="st">"fimaNfipPolicies"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 
Obtaining Data: 1 out of 2 iterations (50% complete)
Obtaining Data: 2 out of 2 iterations (100%
## complete)</code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Note: the data set field is not case sensative, meaning you do not need to </span></span>
<span><span class="co"># use camel case names despite that being the convention in the FEMA documentation.</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fema_data_fields.html">fema_data_fields</a></span><span class="op">(</span>data_set <span class="op">=</span> <span class="st">"fimanfippolicies"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># view the data fields </span></span>
<span><span class="va">df</span></span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 127 × 15</span></span>
<span><span class="co">##    datase…¹ openF…² datas…³ name  title descr…⁴ type  sortO…⁵ isSea…⁶ isNes…⁷ isNul…⁸ prima…⁹ id   </span></span>
<span><span class="co">##    &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;</span></span>
<span><span class="co">##  1 openfem… FimaNf… 2       poli… Poli… Date u… date  29      TRUE    FALSE   TRUE    FALSE   3558…</span></span>
<span><span class="co">##  2 openfem… FimaNf… 1       base… Base… Baseme… smal… 3       TRUE    FALSE   FALSE   FALSE   689d…</span></span>
<span><span class="co">##  3 openfem… FimaNf… 1       cond… Cond… This i… text  6       TRUE    FALSE   FALSE   FALSE   ca12…</span></span>
<span><span class="co">##  4 openfem… FimaNf… 1       crsC… CRS … The Co… smal… 9       TRUE    FALSE   FALSE   FALSE   1923…</span></span>
<span><span class="co">##  5 openfem… FimaNf… 1       dedu… Dedu… The to… text  10      TRUE    FALSE   FALSE   FALSE   a3fb…</span></span>
<span><span class="co">##  6 openfem… FimaNf… 1       dedu… Dedu… The to… text  11      TRUE    FALSE   FALSE   FALSE   7c1b…</span></span>
<span><span class="co">##  7 openfem… FimaNf… 1       elev… Elev… Yes (Y… bool… 12      TRUE    FALSE   FALSE   FALSE   e9b1…</span></span>
<span><span class="co">##  8 openfem… FimaNf… 1       elev… Elev… Indica… text  13      TRUE    FALSE   FALSE   FALSE   b59e…</span></span>
<span><span class="co">##  9 openfem… FimaNf… 1       floo… Floo… NFIP F… text  16      TRUE    FALSE   FALSE   FALSE   42ac…</span></span>
<span><span class="co">## 10 openfem… FimaNf… 1       loca… Loca… Code t… smal… 20      TRUE    FALSE   FALSE   FALSE   a72e…</span></span>
<span><span class="co">## # … with 117 more rows, 2 more variables: lastRefresh &lt;chr&gt;, hash &lt;chr&gt;, and abbreviated variable</span></span>
<span><span class="co">## #   names ¹​datasetId, ²​openFemaDataSet, ³​datasetVersion, ⁴​description, ⁵​sortOrder, ⁶​isSearchable,</span></span>
<span><span class="co">## #   ⁷​isNestedObject, ⁸​isNullable, ⁹​primaryKey</span></span></code></pre>
<p>The FEMA API limits the number of records that can be returned in a single query to 1000, meaning if we want more observations than that, a loop is necessary to iterate over multiple API calls. The <code>open_fema</code> function handles this process automatically, but by default will issue a warning letting you know how many records match your criteria and how many API calls it will take to retrieve all those records and ask you to confirm the request before it starts retrieving data (this behavior can be turned off by setting the <code>ask_before_call</code> argument to <code>FALSE</code>). Additionally an estimated time will be issued to give you a sense of how long it will take to complete the request. For example, requesting the entire NFIP claims data set via <code>open_fema(data_set = "fimaNfipClaims")</code> will yield the following output in the R console.</p>
<pre><code>Calculating estimated API call time...
2600579 matching records found. At 1000 records per call, it will take 2601 individual API calls to get all matching records. It's estimated that this will take approximately 2.12 hours. Continue?
 1 - Yes, get that data!, 0 - No, let me rethink my API call: </code></pre>
<p>Note that the estimated time is based on network conditions at the initial time the call is being made and may not be accurate for large data requests that take long enough for network conditions to potential change significantly during the request. As an aside, for large data requests, like downloading the entire data set, it will usually be faster to perform a bulk download using the <code>bulk_dl</code> function.</p>
<p>Alternatively, we could specify the top_n argument to limit the number of records returned. Specifying top_n greater than 1000 will initiate the same message letting you know how many iterations it will take to get your data. If <code>top_n</code> is less than 1000, the API call will automatically be carried out. In the case below, we will return the first 10 records from the NFIP Claims data.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/open_fema.html">open_fema</a></span><span class="op">(</span>data_set <span class="op">=</span> <span class="st">"fimaNfipClaims"</span>, top_n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span></span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 10 × 73</span></span>
<span><span class="co">##    agricu…¹ asOfDate            basem…² polic…³ crsCl…⁴ dateOfLoss          eleva…⁵ eleva…⁶ eleva…⁷</span></span>
<span><span class="co">##    &lt;chr&gt;    &lt;dttm&gt;              &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;dttm&gt;              &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  </span></span>
<span><span class="co">##  1 FALSE    2020-01-22 00:00:00 NULL    1       8       1998-02-07 00:00:00 FALSE   NULL    NULL   </span></span>
<span><span class="co">##  2 FALSE    2020-01-22 00:00:00 NULL    1       8       2005-08-29 00:00:00 FALSE   NULL    NULL   </span></span>
<span><span class="co">##  3 FALSE    2020-01-22 00:00:00 NULL    1       9       1998-09-28 00:00:00 FALSE   NULL    NULL   </span></span>
<span><span class="co">##  4 FALSE    2019-09-19 00:00:00 1       1       9       1994-10-07 00:00:00 FALSE   NULL    NULL   </span></span>
<span><span class="co">##  5 FALSE    2019-09-19 00:00:00 NULL    1       8       1996-03-11 00:00:00 FALSE   NULL    NULL   </span></span>
<span><span class="co">##  6 FALSE    2020-01-22 00:00:00 NULL    1       NULL    1998-02-03 00:00:00 TRUE    NULL    NULL   </span></span>
<span><span class="co">##  7 FALSE    2020-01-22 00:00:00 NULL    1       5       2017-08-27 00:00:00 FALSE   NULL    NULL   </span></span>
<span><span class="co">##  8 FALSE    2019-10-19 00:00:00 NULL    1       NULL    1992-09-11 00:00:00 FALSE   NULL    NULL   </span></span>
<span><span class="co">##  9 FALSE    2019-10-19 00:00:00 NULL    1       8       1998-09-28 00:00:00 FALSE   NULL    NULL   </span></span>
<span><span class="co">## 10 FALSE    2019-09-19 00:00:00 NULL    1       8       1995-03-11 00:00:00 FALSE   NULL    NULL   </span></span>
<span><span class="co">## # … with 64 more variables: baseFloodElevation &lt;chr&gt;, ratedFloodZone &lt;chr&gt;, houseWorship &lt;chr&gt;,</span></span>
<span><span class="co">## #   locationOfContents &lt;chr&gt;, lowestAdjacentGrade &lt;chr&gt;, lowestFloorElevation &lt;chr&gt;,</span></span>
<span><span class="co">## #   numberOfFloorsInTheInsuredBuilding &lt;chr&gt;, nonProfitIndicator &lt;chr&gt;, obstructionType &lt;chr&gt;,</span></span>
<span><span class="co">## #   occupancyType &lt;chr&gt;, originalConstructionDate &lt;dttm&gt;, originalNBDate &lt;dttm&gt;,</span></span>
<span><span class="co">## #   amountPaidOnBuildingClaim &lt;chr&gt;, amountPaidOnContentsClaim &lt;chr&gt;,</span></span>
<span><span class="co">## #   amountPaidOnIncreasedCostOfComplianceClaim &lt;chr&gt;, postFIRMConstructionIndicator &lt;chr&gt;,</span></span>
<span><span class="co">## #   rateMethod &lt;chr&gt;, smallBusinessIndicatorBuilding &lt;chr&gt;, …</span></span></code></pre>
<p>If we wanted to limit the columns returned we could do so by passing a character vector of data fields to be included in the returned data frame. The data fields for a given data set can be retrieved using the <code><a href="../reference/fema_data_fields.html">fema_data_fields()</a></code> function.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_fields</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fema_data_fields.html">fema_data_fields</a></span><span class="op">(</span><span class="st">"fimanfipclaims"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_fields</span></span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 113 × 15</span></span>
<span><span class="co">##    datase…¹ openF…² datas…³ name  title descr…⁴ type  sortO…⁵ isSea…⁶ isNes…⁷ isNul…⁸ prima…⁹ id   </span></span>
<span><span class="co">##    &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;</span></span>
<span><span class="co">##  1 openfem… FimaNf… 2       wate… Wate… Depth … smal… 61      TRUE    FALSE   TRUE    FALSE   7e46…</span></span>
<span><span class="co">##  2 openfem… FimaNf… 1       base… Base… Baseme… smal… 4       TRUE    FALSE   FALSE   FALSE   be90…</span></span>
<span><span class="co">##  3 openfem… FimaNf… 1       cond… Cond… This i… text  6       TRUE    FALSE   FALSE   FALSE   8690…</span></span>
<span><span class="co">##  4 openfem… FimaNf… 1       comm… Comm… The Co… smal… 9       TRUE    FALSE   FALSE   FALSE   264c…</span></span>
<span><span class="co">##  5 openfem… FimaNf… 1       elev… Elev… Indica… smal… 12      TRUE    FALSE   TRUE    FALSE   a63c…</span></span>
<span><span class="co">##  6 openfem… FimaNf… 1       floo… Floo… Flood … text  15      TRUE    FALSE   TRUE    FALSE   f727…</span></span>
<span><span class="co">##  7 openfem… FimaNf… 1       loca… Loca… Code t… smal… 18      TRUE    FALSE   TRUE    FALSE   9720…</span></span>
<span><span class="co">##  8 openfem… FimaNf… 1       numb… Numb… Code t… smal… 22      TRUE    FALSE   FALSE   FALSE   56d6…</span></span>
<span><span class="co">##  9 openfem… FimaNf… 1       obst… Obst… Code t… smal… 24      TRUE    FALSE   TRUE    FALSE   85b2…</span></span>
<span><span class="co">## 10 openfem… FimaNf… 1       occu… Occu… Code i… smal… 25      TRUE    FALSE   FALSE   FALSE   7c3b…</span></span>
<span><span class="co">## # … with 103 more rows, 2 more variables: lastRefresh &lt;chr&gt;, hash &lt;chr&gt;, and abbreviated variable</span></span>
<span><span class="co">## #   names ¹​datasetId, ²​openFemaDataSet, ³​datasetVersion, ⁴​description, ⁵​sortOrder, ⁶​isSearchable,</span></span>
<span><span class="co">## #   ⁷​isNestedObject, ⁸​isNullable, ⁹​primaryKey</span></span></code></pre>
<p>In this case we will return only the <code>policyCount</code> and <code>countyCode</code> columns.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/open_fema.html">open_fema</a></span><span class="op">(</span>data_set <span class="op">=</span> <span class="st">"fimaNfipClaims"</span>, top_n <span class="op">=</span> <span class="fl">10</span>, select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"policyCount"</span>,<span class="st">"countyCode"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span></span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 10 × 2</span></span>
<span><span class="co">##    policyCount countyCode</span></span>
<span><span class="co">##    &lt;chr&gt;       &lt;chr&gt;     </span></span>
<span><span class="co">##  1 1           06073     </span></span>
<span><span class="co">##  2 1           22071     </span></span>
<span><span class="co">##  3 1           12113     </span></span>
<span><span class="co">##  4 1           45013     </span></span>
<span><span class="co">##  5 1           12009     </span></span>
<span><span class="co">##  6 1           51810     </span></span>
<span><span class="co">##  7 1           48201     </span></span>
<span><span class="co">##  8 1           15003     </span></span>
<span><span class="co">##  9 1           12087     </span></span>
<span><span class="co">## 10 1           06053</span></span></code></pre>
<p>If we want to limit the rows returned rather than the columns, we can also apply filters by specifying values of the columns to return. If we want to quickly see the set of variables that can be used to filter API queries with, we can use the <code><a href="../reference/valid_parameters.html">valid_parameters()</a></code> function to return a tibble containing the variables that are “searchable” for a particular data set.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/valid_parameters.html">valid_parameters</a></span><span class="op">(</span>data_set <span class="op">=</span> <span class="st">"fimaNfipClaims"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">params</span></span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 63 × 1</span></span>
<span><span class="co">##    params                            </span></span>
<span><span class="co">##    &lt;chr&gt;                             </span></span>
<span><span class="co">##  1 waterDepth                        </span></span>
<span><span class="co">##  2 basementEnclosureCrawlspaceType   </span></span>
<span><span class="co">##  3 crsClassificationCode             </span></span>
<span><span class="co">##  4 elevationCertificateIndicator     </span></span>
<span><span class="co">##  5 elevationDifference               </span></span>
<span><span class="co">##  6 ratedFloodZone                    </span></span>
<span><span class="co">##  7 locationOfContents                </span></span>
<span><span class="co">##  8 numberOfFloorsInTheInsuredBuilding</span></span>
<span><span class="co">##  9 obstructionType                   </span></span>
<span><span class="co">## 10 buildingDeductibleCode            </span></span>
<span><span class="co">## # … with 53 more rows</span></span></code></pre>
<p>We can see from the above that both <code>waterDepth</code> and <code>ratedfloodZone</code> are both searchable variables. Thus we can specify a list that contains the values of each variable that we want returned. Before doing that however, it can be useful to learn a bit more about each parameter by using the <code><a href="../reference/parameter_values.html">parameter_values()</a></code> function.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get more information onf the "ratedfloodZone" parameter from the NFIP Claims data set</span></span>
<span><span class="fu"><a href="../reference/parameter_values.html">parameter_values</a></span><span class="op">(</span>data_set <span class="op">=</span> <span class="st">"fimaNfipClaims"</span>,data_field <span class="op">=</span> <span class="st">"ratedFloodZone"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Data Set: FimaNfipClaims</span></span>
<span><span class="co">## Data Field: ratedFloodZone</span></span>
<span><span class="co">## Data Field Description: Formerly called floodZone. NFIP Flood Zone derived from the Flood Insurance Rate Map (FIRM) used to rate the insured property.A - Special Flood with no Base Flood Elevation on FIRM; AE, A1-A30 - Special Flood with Base Flood Elevation on FIRM; A99 - Special Flood with Protection Zone; AH, AHB* - Special Flood with Shallow Ponding; AO, AOB* - Special Flood with Sheet Flow; X, B - Moderate Flood from primary water source.  Pockets of areas subject to drainage problems; X, C - Minimal Flood from primary water source.  Pockets of areas subject to drainage problems; D - Possible Flood; V - Velocity Flood with no Base Flood Elevation on FIRM; VE, V1-V30 - Velocity Flood with Base Flood Elevation on FIRM; AE, VE, X - New zone designations used on new maps starting January 1, 1986, in lieu of A1-A30, V1-V30, and B and C; AR - A Special Flood Hazard Area that results from the decertification of a previously accredited flood protection system that is determined to be in the process of being restored to provide base flood protection;AR Dual Zones - (AR/AE, AR/A1-A30, AR/AH, AR/AO, AR/A) Areas subject to flooding from failure of the flood protection system (Zone AR) which also overlap an existing Special Flood Hazard Area as a dual zone; *AHB, AOB, ARE, ARH, ARO, and ARA are not risk zones shown on a map, but are acceptable values for rating purposes</span></span>
<span><span class="co">## Data Field Example Values: c("X", "AE", "VE", "NULL", "C", "V")</span></span>
<span><span class="co">## More Information Available at: https://www.fema.gov/about/openfema/data-sets</span></span></code></pre>
<p>As can be seen, <code><a href="../reference/parameter_values.html">parameter_values()</a></code> returns the data set name, the data field (i.e. the searchable parameter), a description of the data field, and a vector of examples of the data field values which can be useful for seeing how the values are formatted in the data.</p>
<p>We can see from the above that <code>ratedFloodZone</code> is a character in the data and from the description we know that “AE” and “X” are both valid values for the <code>ratedFloodZone</code> parameter. We can thus define a filter to return only records from AE and X flood zones.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># construct a filter that limits records to those in AE flood zones</span></span>
<span><span class="va">my_filters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ratedFloodZone <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AE"</span>,<span class="st">"X"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># pass the filter to the open_fema function.</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/open_fema.html">open_fema</a></span><span class="op">(</span>data_set <span class="op">=</span> <span class="st">"fimaNfipclaims"</span>, top_n <span class="op">=</span> <span class="fl">10</span>, </span>
<span>               select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"policyCount"</span>,<span class="st">"ratedFloodZone"</span><span class="op">)</span>,</span>
<span>               filters <span class="op">=</span> <span class="va">my_filters</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">df</span></span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 10 × 2</span></span>
<span><span class="co">##    policyCount ratedFloodZone</span></span>
<span><span class="co">##    &lt;chr&gt;       &lt;chr&gt;         </span></span>
<span><span class="co">##  1 1           X             </span></span>
<span><span class="co">##  2 1           X             </span></span>
<span><span class="co">##  3 1           X             </span></span>
<span><span class="co">##  4 1           X             </span></span>
<span><span class="co">##  5 1           X             </span></span>
<span><span class="co">##  6 1           AE            </span></span>
<span><span class="co">##  7 1           X             </span></span>
<span><span class="co">##  8 1           AE            </span></span>
<span><span class="co">##  9 1           AE            </span></span>
<span><span class="co">## 10 1           X</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="more-examples">More Examples<a class="anchor" aria-label="anchor" href="#more-examples"></a>
</h2>
<div class="section level3">
<h3 id="example-return-the-first-100-nfip-claims-for-florida-that-happened-between-2010-and-2020-">Example: Return the first 100 NFIP claims for Florida that happened between 2010 and 2020.<a class="anchor" aria-label="anchor" href="#example-return-the-first-100-nfip-claims-for-florida-that-happened-between-2010-and-2020-"></a>
</h3>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/open_fema.html">open_fema</a></span><span class="op">(</span>data_set <span class="op">=</span> <span class="st">"fimaNfipClaims"</span>,</span>
<span>                 top_n <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                 filters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>state <span class="op">=</span> <span class="st">"FL"</span>,</span>
<span>                                yearOfLoss <span class="op">=</span> <span class="st">"&gt;= 2010"</span>,</span>
<span>                                yearOfLoss <span class="op">=</span> <span class="st">"&lt;= 2020"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span></span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 100 × 73</span></span>
<span><span class="co">##    agricu…¹ asOfDate            basem…² polic…³ crsCl…⁴ dateOfLoss          eleva…⁵ eleva…⁶ eleva…⁷</span></span>
<span><span class="co">##    &lt;chr&gt;    &lt;dttm&gt;              &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;dttm&gt;              &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  </span></span>
<span><span class="co">##  1 FALSE    2020-01-22 00:00:00 NULL    1       7       2012-09-06 00:00:00 FALSE   NULL    3      </span></span>
<span><span class="co">##  2 FALSE    2020-01-22 00:00:00 NULL    1       7       2017-10-07 00:00:00 FALSE   NULL    NULL   </span></span>
<span><span class="co">##  3 FALSE    2021-10-20 00:00:00 NULL    1       6       2014-04-30 00:00:00 TRUE    NULL    -3     </span></span>
<span><span class="co">##  4 FALSE    2020-01-22 00:00:00 NULL    1       5       2017-09-10 00:00:00 FALSE   NULL    NULL   </span></span>
<span><span class="co">##  5 FALSE    2022-06-17 00:00:00 NULL    1       7       2017-09-09 00:00:00 FALSE   NULL    NULL   </span></span>
<span><span class="co">##  6 FALSE    2020-01-22 00:00:00 NULL    1       6       2012-06-09 00:00:00 FALSE   NULL    NULL   </span></span>
<span><span class="co">##  7 FALSE    2020-01-22 00:00:00 NULL    1       8       2011-10-08 00:00:00 FALSE   NULL    NULL   </span></span>
<span><span class="co">##  8 FALSE    2020-01-22 00:00:00 NULL    1       6       2014-04-29 00:00:00 FALSE   NULL    NULL   </span></span>
<span><span class="co">##  9 FALSE    2020-01-22 00:00:00 NULL    1       5       2012-06-24 00:00:00 FALSE   NULL    NULL   </span></span>
<span><span class="co">## 10 FALSE    2023-07-31 00:00:00 NULL    1       7       2014-04-29 00:00:00 TRUE    NULL    3      </span></span>
<span><span class="co">## # … with 90 more rows, 64 more variables: baseFloodElevation &lt;chr&gt;, ratedFloodZone &lt;chr&gt;,</span></span>
<span><span class="co">## #   houseWorship &lt;chr&gt;, locationOfContents &lt;chr&gt;, lowestAdjacentGrade &lt;chr&gt;,</span></span>
<span><span class="co">## #   lowestFloorElevation &lt;chr&gt;, numberOfFloorsInTheInsuredBuilding &lt;chr&gt;,</span></span>
<span><span class="co">## #   nonProfitIndicator &lt;chr&gt;, obstructionType &lt;chr&gt;, occupancyType &lt;chr&gt;,</span></span>
<span><span class="co">## #   originalConstructionDate &lt;dttm&gt;, originalNBDate &lt;dttm&gt;, amountPaidOnBuildingClaim &lt;chr&gt;,</span></span>
<span><span class="co">## #   amountPaidOnContentsClaim &lt;chr&gt;, amountPaidOnIncreasedCostOfComplianceClaim &lt;chr&gt;,</span></span>
<span><span class="co">## #   postFIRMConstructionIndicator &lt;chr&gt;, rateMethod &lt;chr&gt;, smallBusinessIndicatorBuilding &lt;chr&gt;, …</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="example-get-data-on-all-hazard-mitigation-assistance-projects-associated-with-flood-mitigation-in-florida-">Example: Get data on all Hazard Mitigation Assistance Projects associated with flood mitigation in Florida.<a class="anchor" aria-label="anchor" href="#example-get-data-on-all-hazard-mitigation-assistance-projects-associated-with-flood-mitigation-in-florida-"></a>
</h3>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># see which parameter can be used for filtering the Hazard Mitigation Grants data set</span></span>
<span><span class="fu"><a href="../reference/valid_parameters.html">valid_parameters</a></span><span class="op">(</span><span class="st">"HazardMitigationAssistanceProjects"</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 29 × 1</span></span>
<span><span class="co">##    params           </span></span>
<span><span class="co">##    &lt;chr&gt;            </span></span>
<span><span class="co">##  1 status           </span></span>
<span><span class="co">##  2 subrecipient     </span></span>
<span><span class="co">##  3 projectIdentifier</span></span>
<span><span class="co">##  4 programArea      </span></span>
<span><span class="co">##  5 programFy        </span></span>
<span><span class="co">##  6 region           </span></span>
<span><span class="co">##  7 state            </span></span>
<span><span class="co">##  8 stateNumberCode  </span></span>
<span><span class="co">##  9 county           </span></span>
<span><span class="co">## 10 countyCode       </span></span>
<span><span class="co">## # … with 19 more rows</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># see how values of "programArea" are formatted</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/parameter_values.html">parameter_values</a></span><span class="op">(</span>data_set <span class="op">=</span> <span class="st">"HazardMitigationAssistanceProjects"</span>, data_field <span class="op">=</span> <span class="st">"programArea"</span>, message <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> </span>
<span><span class="va">params</span></span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 3 × 4</span></span>
<span><span class="co">##   `Data Set`                         `Data Field` `Data Field Description`                 Data F…¹</span></span>
<span><span class="co">##   &lt;chr&gt;                              &lt;chr&gt;        &lt;chr&gt;                                    &lt;list&gt;  </span></span>
<span><span class="co">## 1 HazardMitigationAssistanceProjects programArea  Hazard Mitigation Assistance grant prog… &lt;tibble&gt;</span></span>
<span><span class="co">## 2 HazardMitigationAssistanceProjects programArea  Hazard Mitigation Assistance grant prog… &lt;tibble&gt;</span></span>
<span><span class="co">## 3 HazardMitigationAssistanceProjects programArea  Hazard Mitigation Assistance grant prog… &lt;tibble&gt;</span></span>
<span><span class="co">## # … with abbreviated variable name ¹​`Data Field Example Values`</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check to see how "state" is formatted</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/parameter_values.html">parameter_values</a></span><span class="op">(</span>data_set <span class="op">=</span> <span class="st">"HazardMitigationAssistanceProjects"</span>, data_field <span class="op">=</span> <span class="st">"state"</span>, message <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> </span>
<span><span class="va">params</span></span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 3 × 4</span></span>
<span><span class="co">##   `Data Set`                         `Data Field` `Data Field Description`                 Data F…¹</span></span>
<span><span class="co">##   &lt;chr&gt;                              &lt;chr&gt;        &lt;chr&gt;                                    &lt;list&gt;  </span></span>
<span><span class="co">## 1 HazardMitigationAssistanceProjects state        Full name of the State (e.g., Virginia)… &lt;tibble&gt;</span></span>
<span><span class="co">## 2 HazardMitigationAssistanceProjects state        Full name of the State (e.g., Virginia)… &lt;tibble&gt;</span></span>
<span><span class="co">## 3 HazardMitigationAssistanceProjects state        Full name of the State (e.g., Virginia)… &lt;tibble&gt;</span></span>
<span><span class="co">## # … with abbreviated variable name ¹​`Data Field Example Values`</span></span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># construct a list containing filters for Flood Mitigation Assistance projects in Florida</span></span>
<span><span class="va">filter_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>programArea <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FMA"</span><span class="op">)</span>,</span>
<span>                 state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Florida"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># pass filter_list to the open_fema function to retreieve data.</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/open_fema.html">open_fema</a></span><span class="op">(</span>data_set <span class="op">=</span> <span class="st">"HazardMitigationAssistanceProjects"</span>, filters <span class="op">=</span> <span class="va">filter_list</span>, </span>
<span>               ask_before_call <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span></span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 345 × 31</span></span>
<span><span class="co">##    projectIden…¹ progr…² progr…³ region state state…⁴ county count…⁵ disas…⁶ proje…⁷ proje…⁸ status</span></span>
<span><span class="co">##    &lt;chr&gt;         &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; </span></span>
<span><span class="co">##  1 FMA-PJ-04-FL… FMA     2005    4      Flor… 12      Browa… 11      NULL    BROWARD 405.1:… Closed</span></span>
<span><span class="co">##  2 FMA-PJ-04-FL… FMA     2005    4      Flor… 12      Volus… 127     NULL    VOLUSIA 200.1:… Closed</span></span>
<span><span class="co">##  3 FMA-PJ-04-FL… FMA     2017    4      Flor… 12      Clay   19      NULL    CLAY    200.1:… Closed</span></span>
<span><span class="co">##  4 FMA-PJ-04-FL… FMA     2018    4      Flor… 12      Clay   19      NULL    CLAY    202.1:… Oblig…</span></span>
<span><span class="co">##  5 FMA-PJ-04-FL… FMA     2008    4      Flor… 12      Volus… 127     NULL    VOLUSIA 202.2:… Closed</span></span>
<span><span class="co">##  6 FMA-PJ-04-FL… FMA     2007    4      Flor… 12      Volus… 127     NULL    VOLUSIA 202.1:… Closed</span></span>
<span><span class="co">##  7 FMA-PJ-04-FL… FMA     2009    4      Flor… 12      Volus… 127     NULL    VOLUSIA 202.1:… Closed</span></span>
<span><span class="co">##  8 FMA-PJ-04-FL… FMA     2016    4      Flor… 12      Volus… 127     NULL    VOLUSIA 200.1:… Closed</span></span>
<span><span class="co">##  9 FMA-PJ-04-FL… FMA     2009    4      Flor… 12      Volus… 127     NULL    VOLUSIA 200.2:… Closed</span></span>
<span><span class="co">## 10 FMA-PJ-04-FL… FMA     2012    4      Flor… 12      Volus… 127     NULL    VOLUSIA 202.1:… Closed</span></span>
<span><span class="co">## # … with 335 more rows, 19 more variables: recipient &lt;chr&gt;, recipientTribalIndicator &lt;chr&gt;,</span></span>
<span><span class="co">## #   subrecipient &lt;chr&gt;, subrecipientTribalIndicator &lt;chr&gt;, dataSource &lt;chr&gt;, dateApproved &lt;dttm&gt;,</span></span>
<span><span class="co">## #   dateClosed &lt;dttm&gt;, dateInitiallyApproved &lt;dttm&gt;, projectAmount &lt;chr&gt;,</span></span>
<span><span class="co">## #   federalShareObligated &lt;chr&gt;, subrecipientAdminCostAmt &lt;chr&gt;, srmcObligatedAmt &lt;chr&gt;,</span></span>
<span><span class="co">## #   recipientAdminCostAmt &lt;chr&gt;, costSharePercentage &lt;chr&gt;, benefitCostRatio &lt;chr&gt;,</span></span>
<span><span class="co">## #   netValueBenefits &lt;chr&gt;, numberOfFinalProperties &lt;chr&gt;, numberOfProperties &lt;chr&gt;, id &lt;chr&gt;, and</span></span>
<span><span class="co">## #   abbreviated variable names ¹​projectIdentifier, ²​programArea, ³​programFy, ⁴​stateNumberCode, …</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="example-determine-how-much-money-was-awarded-by-fema-for-rental-assistance-following-hurricane-irma-">Example: Determine how much money was awarded by FEMA for rental assistance following Hurricane Irma.<a class="anchor" aria-label="anchor" href="#example-determine-how-much-money-was-awarded-by-fema-for-rental-assistance-following-hurricane-irma-"></a>
</h3>
<p>Get a dataset description for the <code>HousingAssistanceRenters</code> data set to see if this is the right data set for the question</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get meta data for the `HousingAssistanceRenters`</span></span>
<span><span class="va">ds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fema_data_sets.html">fema_data_sets</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="va">ds</span> <span class="op">&lt;-</span> <span class="va">ds</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">ds</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"HousingAssistanceRenters"</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="co"># there are two entries corresponding to two versions of the data set, </span></span>
<span><span class="co"># we want the most recent one</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ds</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2</span></span></code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ds</span> <span class="op">&lt;-</span> <span class="va">ds</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">ds</span><span class="op">$</span><span class="va">version</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">ds</span><span class="op">$</span><span class="va">version</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># now print out the data set description and make sure its the data set </span></span>
<span><span class="co"># that applicable or our research question</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ds</span><span class="op">$</span><span class="va">description</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "The dataset was generated by FEMA’s Enterprise Coordination &amp; Information Management (ECIM) Reporting team and is primarily composed of data from Housing Assistance Program reporting authority from FEMA registration renters and owners within the state, county, zip where the registration is valid. \n\nThis dataset contains aggregated, non-PII data on FEMA’s Housing Assistance Program within the state, county, zip where the registration is valid for the declarations, starting with disaster declarations number 4116.  The data is divided into data for renters and data for property owners. Additional core data elements include number of applicants, county, zip code, severity of damage, owner or renter. Data is self-reported and as such is subject to human error. To learn more about disaster assistance please visit https://www.fema.gov/individual-disaster-assistance.\n\nThis is raw, unedited data from FEMA's National Emergency Management Information System (NEMIS) and as such is subject to a small percentage of human error. For example, when an applicant registers they enter their street and city address.  The system runs a check and suggests a county.  The applicant, if registering online can override that choice.  If they are registering via the call center the Human Services Specialist (HSS) representatives are instructed to ask (not offer) what county they live in.  So even though the system might suggest County A,  an applicant has the right to choose County B.  \n\nThe financial information is derived from NEMIS and not FEMA's official financial systems.  Due to differences in reporting periods, status of obligations and how business rules are applied, this financial information may differ slightly from official publication on public websites such as usaspending.gov;  this dataset is not intended to be used for any official federal financial reporting.\n\nCitation: The Agency’s preferred citation for datasets (API usage or file downloads) can be found on the OpenFEMA Terms and Conditions page, Citing Data section: https://www.fema.gov/about/openfema/terms-conditions.\n\nIf you have media inquiries about this dataset, please email the FEMA News Desk FEMA-News-Desk@fema.dhs.gov or call (202) 646-3272.  For inquiries about FEMA's data and Open government program please contact the OpenFEMA team via email OpenFEMA@fema.dhs.gov."</span></span></code></pre>
<p>See which columns we can filter on to select just Hurricane Irma related grants</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># see which parameter can be used for filtering the Housing Assistance for Renters </span></span>
<span><span class="fu"><a href="../reference/valid_parameters.html">valid_parameters</a></span><span class="op">(</span><span class="st">"HousingAssistanceRenters"</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 21 × 1</span></span>
<span><span class="co">##    params                    </span></span>
<span><span class="co">##    &lt;chr&gt;                     </span></span>
<span><span class="co">##  1 disasterNumber            </span></span>
<span><span class="co">##  2 state                     </span></span>
<span><span class="co">##  3 county                    </span></span>
<span><span class="co">##  4 city                      </span></span>
<span><span class="co">##  5 zipCode                   </span></span>
<span><span class="co">##  6 validRegistrations        </span></span>
<span><span class="co">##  7 totalInspected            </span></span>
<span><span class="co">##  8 totalInspectedWithNoDamage</span></span>
<span><span class="co">##  9 totalWithModerateDamage   </span></span>
<span><span class="co">## 10 totalWithMajorDamage      </span></span>
<span><span class="co">## # … with 11 more rows</span></span></code></pre>
<p>All we have in this data set is the <code>disasterNumber</code>. Thus, to filter on a specific disaster we have to load the <code>FemaWebDisasterDeclarations</code> data find the disaster number associated with the event we are interested in.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># call the disaster declarations</span></span>
<span><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu">rfema</span><span class="fu">::</span><span class="fu"><a href="../reference/open_fema.html">open_fema</a></span><span class="op">(</span>data_set <span class="op">=</span> <span class="st">"FemaWebDisasterDeclarations"</span>, ask_before_call <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 
Obtaining Data: 1 out of 5 iterations (20% complete)
Obtaining Data: 2 out of 5 iterations (40%
## complete)
Obtaining Data: 3 out of 5 iterations (60% complete)
Obtaining Data: 4 out of 5 iterations
## (80% complete)
Obtaining Data: 5 out of 5 iterations (100% complete)</code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># filter disaster declarations to those with "hurricane" in the name</span></span>
<span><span class="va">hurricanes</span> <span class="op">&lt;-</span> <span class="fu">distinct</span><span class="op">(</span><span class="va">dd</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"hurricane"</span>,<span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="va">disasterName</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">disasterName</span>, <span class="va">disasterNumber</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">hurricanes</span></span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 393 × 2</span></span>
<span><span class="co">##    disasterName     disasterNumber</span></span>
<span><span class="co">##    &lt;chr&gt;            &lt;chr&gt;         </span></span>
<span><span class="co">##  1 HURRICANE IDALIA 4734          </span></span>
<span><span class="co">##  2 HURRICANE IDALIA 4738          </span></span>
<span><span class="co">##  3 HURRICANE LANE   3399          </span></span>
<span><span class="co">##  4 HURRICANE IAN    4673          </span></span>
<span><span class="co">##  5 HURRICANE HENRI  3563          </span></span>
<span><span class="co">##  6 HURRICANE LEE    3599          </span></span>
<span><span class="co">##  7 HURRICANE LEE    3598          </span></span>
<span><span class="co">##  8 HURRICANE IDALIA 3597          </span></span>
<span><span class="co">##  9 HURRICANE NICOLE 4680          </span></span>
<span><span class="co">## 10 HURRICANE IAN    4677          </span></span>
<span><span class="co">## # … with 383 more rows</span></span></code></pre>
<p>We can see immediately that disaster numbers do not uniquely identify an event, since multiple disaster declarations may be declared for the same event, but in different locations. Thus to filter on a particular event, we need to collect all the disaster declaration numbers corresponding to that event (in this case Hurricane Irma).</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get all disaster declarations associated with hurricane irma. </span></span>
<span><span class="co"># notice the use of grepl() which picked up a disaster declaration name </span></span>
<span><span class="co"># that was different than all the others.</span></span>
<span><span class="va">dd_irma</span> <span class="op">&lt;-</span> <span class="va">hurricanes</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"irma"</span>,<span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="va">disasterName</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dd_irma</span></span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 13 × 2</span></span>
<span><span class="co">##    disasterName                               disasterNumber</span></span>
<span><span class="co">##    &lt;chr&gt;                                      &lt;chr&gt;         </span></span>
<span><span class="co">##  1 HURRICANE IRMA                             4346          </span></span>
<span><span class="co">##  2 HURRICANE IRMA - SEMINOLE TRIBE OF FLORIDA 4341          </span></span>
<span><span class="co">##  3 HURRICANE IRMA                             4338          </span></span>
<span><span class="co">##  4 HURRICANE IRMA                             3389          </span></span>
<span><span class="co">##  5 HURRICANE IRMA                             4337          </span></span>
<span><span class="co">##  6 HURRICANE IRMA                             4336          </span></span>
<span><span class="co">##  7 HURRICANE IRMA                             3388          </span></span>
<span><span class="co">##  8 HURRICANE IRMA                             3387          </span></span>
<span><span class="co">##  9 HURRICANE IRMA                             3386          </span></span>
<span><span class="co">## 10 HURRICANE IRMA                             4335          </span></span>
<span><span class="co">## 11 HURRICANE IRMA                             3385          </span></span>
<span><span class="co">## 12 HURRICANE IRMA                             3384          </span></span>
<span><span class="co">## 13 HURRICANE IRMA                             3383</span></span></code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get a vector of just the disaster declaration numbers</span></span>
<span><span class="va">dd_nums_irma</span> <span class="op">&lt;-</span> <span class="va">dd_irma</span><span class="op">$</span><span class="va">disasterNumber</span></span></code></pre></div>
<p>Now we are read to filter our API call for the <code>HousingAssistanceRenters</code> data set.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># construct filter list</span></span>
<span><span class="va">filter_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>disasterNumber <span class="op">=</span> <span class="va">dd_nums_irma</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make the API call to get individual assistance grants awarded to renters for hurricane Irma damages.</span></span>
<span><span class="va">assistance_irma</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/open_fema.html">open_fema</a></span><span class="op">(</span>data_set <span class="op">=</span> <span class="st">"HousingAssistanceRenters"</span>, filters <span class="op">=</span> <span class="va">filter_list</span>, ask_before_call <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 
Obtaining Data: 1 out of 6 iterations (16.67% complete)
Obtaining Data: 2 out of 6 iterations
## (33.33% complete)
Obtaining Data: 3 out of 6 iterations (50% complete)
Obtaining Data: 4 out of 6
## iterations (66.67% complete)
Obtaining Data: 5 out of 6 iterations (83.33% complete)
Obtaining Data:
## 6 out of 6 iterations (100% complete)</code></pre>
<p>Check out the returned data</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check out the returned data</span></span>
<span><span class="va">assistance_irma</span></span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 5,358 × 21</span></span>
<span><span class="co">##    disasterNum…¹ state county city  zipCode valid…² total…³ total…⁴ total…⁵ total…⁶ total…⁷ appro…⁸</span></span>
<span><span class="co">##    &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  </span></span>
<span><span class="co">##  1 4335          VI    St. J… ST J… 00083   1       0       1       0       0       0       1      </span></span>
<span><span class="co">##  2 4335          VI    St. T… CHAL… 00801   1       0       1       0       0       0       0      </span></span>
<span><span class="co">##  3 4335          VI    St. T… CHAR… 00801   1       1       1       0       0       0       0      </span></span>
<span><span class="co">##  4 4335          VI    St. T… CHAR… 00801   10      8       6       3       0       0       5      </span></span>
<span><span class="co">##  5 4335          VI    St. T… CHAR… 00801   1       1       1       0       0       0       1      </span></span>
<span><span class="co">##  6 4335          VI    St. T… CHAR… 00801   1       1       1       0       0       0       1      </span></span>
<span><span class="co">##  7 4335          VI    St. T… SAIN… 00801   7       6       7       0       0       0       1      </span></span>
<span><span class="co">##  8 4335          VI    St. T… STT   00801   1       1       1       0       0       0       0      </span></span>
<span><span class="co">##  9 4335          VI    St. T… STTH… 00801   6       4       4       2       0       0       2      </span></span>
<span><span class="co">## 10 4335          VI    St. T… ST T… 00801   219     181     142     66      10      0       126    </span></span>
<span><span class="co">## # … with 5,348 more rows, 9 more variables: totalApprovedIhpAmount &lt;chr&gt;,</span></span>
<span><span class="co">## #   repairReplaceAmount &lt;chr&gt;, rentalAmount &lt;chr&gt;, otherNeedsAmount &lt;chr&gt;,</span></span>
<span><span class="co">## #   approvedBetween1And10000 &lt;chr&gt;, approvedBetween10001And25000 &lt;chr&gt;,</span></span>
<span><span class="co">## #   approvedBetween25001AndMax &lt;chr&gt;, totalMaxGrants &lt;chr&gt;, id &lt;chr&gt;, and abbreviated variable</span></span>
<span><span class="co">## #   names ¹​disasterNumber, ²​validRegistrations, ³​totalInspected, ⁴​totalInspectedWithNoDamage,</span></span>
<span><span class="co">## #   ⁵​totalWithModerateDamage, ⁶​totalWithMajorDamage, ⁷​totalWithSubstantialDamage,</span></span>
<span><span class="co">## #   ⁸​approvedForFemaAssistance</span></span></code></pre>
<p>Now we can answer our original question: How much did FEMA awarded for rental assistance following Hurricane Irma?</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sum the rentalAmount Column</span></span>
<span><span class="va">rent_assistance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">assistance_irma</span><span class="op">$</span><span class="va">rentalAmount</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># scale to millions</span></span>
<span><span class="va">rent_assistance</span> <span class="op">&lt;-</span> <span class="va">rent_assistance</span><span class="op">/</span><span class="fl">1000000</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"$"</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">rent_assistance</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>             <span class="st">" million was awarded by FEMA for rental assistance following Hurricane Irma"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "$314.64 million was awarded by FEMA for rental assistance following Hurricane Irma"</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="clean-one-of-the-data-sets-with-a-nested-structure">Clean one of the data sets with a nested structure<a class="anchor" aria-label="anchor" href="#clean-one-of-the-data-sets-with-a-nested-structure"></a>
</h2>
<p>Some data sets that get returned from the FEMA API will be in a nested format. Data from the Integrated Public Alert &amp; Warning System (IPAWS) is one such example of this. See for example the first column of the IPAWS data set, which is XML data returned as a character. Most of the useful information from this data set is in that first column, but isn’t in a form that will be useful for most R users.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get the first ten entries from the IPAWS data set</span></span>
<span><span class="va">ipaws</span> <span class="op">&lt;-</span> <span class="fu">rfema</span><span class="fu">::</span><span class="fu"><a href="../reference/open_fema.html">open_fema</a></span><span class="op">(</span><span class="st">"IpawsArchivedAlerts"</span>, top_n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">ipaws</span></span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 100 × 18</span></span>
<span><span class="co">##    originalM…¹ ident…² sender sent  status msgType source scope restr…³ addre…⁴ code  note  searc…⁵</span></span>
<span><span class="co">##    &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  </span></span>
<span><span class="co">##  1 "&lt;?xml ver… NWS-14… w-nws… 2016… Actual Cancel  NULL   Publ… NULL    NULL    "lis… NULL  "NULL" </span></span>
<span><span class="co">##  2 "&lt;?xml ver… NWS-14… w-nws… 2016… Actual Alert   NULL   Publ… NULL    NULL    "lis… NULL  "list(…</span></span>
<span><span class="co">##  3 "&lt;?xml ver… NWS-14… w-nws… 2016… Actual Alert   NULL   Publ… NULL    NULL    "lis… NULL  "list(…</span></span>
<span><span class="co">##  4 "&lt;?xml ver… NWS-14… w-nws… 2016… Actual Cancel  NULL   Publ… NULL    NULL    "lis… NULL  "list(…</span></span>
<span><span class="co">##  5 "&lt;?xml ver… NWS-14… w-nws… 2016… Actual Update  NULL   Publ… NULL    NULL    "lis… NULL  "list(…</span></span>
<span><span class="co">##  6 "&lt;?xml ver… NWS-14… w-nws… 2016… Actual Alert   NULL   Publ… NULL    NULL    "lis… NULL  "NULL" </span></span>
<span><span class="co">##  7 "&lt;?xml ver… NWS-14… w-nws… 2016… Actual Alert   NULL   Publ… NULL    NULL    "lis… NULL  "list(…</span></span>
<span><span class="co">##  8 "&lt;?xml ver… NWS-14… w-nws… 2016… Actual Alert   NULL   Publ… NULL    NULL    "lis… NULL  "list(…</span></span>
<span><span class="co">##  9 "&lt;?xml ver… NWS-14… w-nws… 2016… Actual Update  NULL   Publ… NULL    NULL    "lis… NULL  "NULL" </span></span>
<span><span class="co">## 10 "&lt;?xml ver… NWS-14… w-nws… 2016… Actual Update  NULL   Publ… NULL    NULL    "lis… NULL  "NULL" </span></span>
<span><span class="co">## # … with 90 more rows, 5 more variables: incidents &lt;chr&gt;, cogId &lt;chr&gt;, id &lt;chr&gt;, xmlns &lt;chr&gt;,</span></span>
<span><span class="co">## #   info &lt;chr&gt;, and abbreviated variable names ¹​originalMessage, ²​identifier, ³​restriction,</span></span>
<span><span class="co">## #   ⁴​addresses, ⁵​searchGeometry</span></span></code></pre>
<p>The following is one method for converting the xml data into tabular form.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.omegahat.net/RSXML/" class="external-link">XML</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create function to unnest the ipaws entries</span></span>
<span><span class="va">unnest_ipaws</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">xml_entry</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="co"># convert the raw xml data to a list</span></span>
<span>  <span class="va">xml_data</span> <span class="op">&lt;-</span> <span class="fu">XML</span><span class="fu">::</span><span class="fu">xmlToList</span><span class="op">(</span><span class="va">xml_entry</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># get names of the list elements in xml data</span></span>
<span>  <span class="va">names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">xml_data</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># get a summary of the data to id which elements are nested</span></span>
<span>  <span class="va">data_sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">xml_data</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># put all the non nested elements into a data frame</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">xml_data</span><span class="op">[</span><span class="va">names</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">data_sum</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># get vector of elements that need to be unnested</span></span>
<span>  <span class="va">needs_unnesting</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">data_sum</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># loop over the elements identified above</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="va">needs_unnesting</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>    <span class="co"># unlist the nested data</span></span>
<span>    <span class="va">unlisted_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">xml_data</span><span class="op">[</span><span class="va">k</span><span class="op">]</span>, recursive <span class="op">=</span> <span class="cn">T</span>, use.names <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># store the unlisted data as a data frame</span></span>
<span>    <span class="va">temp_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">unlisted_data</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># add the unnested data frame to the existing "df" data frame</span></span>
<span>    <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind.data.frame</a></span><span class="op">(</span><span class="va">df</span>,<span class="va">temp_df</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># get the first 100 entries from the IPAWS alerts data set</span></span>
<span><span class="va">ipaws</span> <span class="op">&lt;-</span> <span class="fu">rfema</span><span class="fu">::</span><span class="fu"><a href="../reference/open_fema.html">open_fema</a></span><span class="op">(</span><span class="st">"IpawsArchivedAlerts"</span>, top_n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># apply the `unnest_ipaws` function over all the XML entries in the returned `ipaws` object</span></span>
<span><span class="va">ipaws_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">ipaws</span><span class="op">$</span><span class="va">originalMessage</span>, <span class="va">unnest_ipaws</span>, simplify <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># convert the `ipaws_list` into a data frame</span></span>
<span><span class="va">ipaws_df</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">ipaws_list</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># the number of columns can get unwieldy because of all the unique pieces of information</span></span>
<span><span class="co"># in that "info" element that get tacked on</span></span>
<span></span>
<span><span class="co"># dropping the geocoding columns could help simplify</span></span>
<span><span class="va">ipaws_df</span> <span class="op">&lt;-</span> <span class="va">ipaws_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"geocode"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># dropping the "parameter value" columns would also help</span></span>
<span><span class="co"># (depending on if those are needed or not)</span></span>
<span><span class="va">ipaws_df</span> <span class="op">&lt;-</span> <span class="va">ipaws_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"parameter.value"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># view the final data</span></span>
<span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">ipaws_df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 100 × 37</span></span>
<span><span class="co">##    identi…¹ sender sent  status msgType scope code  refer…² info.…³ info.…⁴ info.…⁵ info.…⁶ info.…⁷</span></span>
<span><span class="co">##    &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  </span></span>
<span><span class="co">##  1 NWS-141… w-nws… 2016… Actual Cancel  Publ… IPAW… w-nws.… Met     Small … Avoid   Expect… Minor  </span></span>
<span><span class="co">##  2 NWS-141… w-nws… 2016… Actual Alert   Publ… IPAW… &lt;NA&gt;    Met     Severe… Shelter Immedi… Severe </span></span>
<span><span class="co">##  3 NWS-141… w-nws… 2016… Actual Alert   Publ… IPAW… &lt;NA&gt;    Met     Specia… Execute Expect… Modera…</span></span>
<span><span class="co">##  4 NWS-141… w-nws… 2016… Actual Cancel  Publ… IPAW… w-nws.… Met     Severe… Shelter Immedi… Severe </span></span>
<span><span class="co">##  5 NWS-141… w-nws… 2016… Actual Update  Publ… IPAW… w-nws.… Met     Severe… Shelter Immedi… Severe </span></span>
<span><span class="co">##  6 NWS-141… w-nws… 2016… Actual Alert   Publ… IPAW… &lt;NA&gt;    Met     Beach … Avoid   Expect… Modera…</span></span>
<span><span class="co">##  7 NWS-141… w-nws… 2016… Actual Alert   Publ… IPAW… &lt;NA&gt;    Met     Severe… Shelter Immedi… Severe </span></span>
<span><span class="co">##  8 NWS-141… w-nws… 2016… Actual Alert   Publ… IPAW… &lt;NA&gt;    Met     Marine… Monitor Expect… Minor  </span></span>
<span><span class="co">##  9 NWS-141… w-nws… 2016… Actual Update  Publ… IPAW… w-nws.… Met     Small … Avoid   Expect… Minor  </span></span>
<span><span class="co">## 10 NWS-141… w-nws… 2016… Actual Update  Publ… IPAW… w-nws.… Met     Hazard… Avoid   Expect… Modera…</span></span>
<span><span class="co">## # … with 90 more rows, 24 more variables: info.certainty &lt;chr&gt;, info.eventCode.valueName &lt;chr&gt;,</span></span>
<span><span class="co">## #   info.eventCode.value &lt;chr&gt;, info.eventCode.valueName.1 &lt;chr&gt;, info.eventCode.value.1 &lt;chr&gt;,</span></span>
<span><span class="co">## #   info.effective &lt;chr&gt;, info.onset &lt;chr&gt;, info.expires &lt;chr&gt;, info.senderName &lt;chr&gt;,</span></span>
<span><span class="co">## #   info.headline &lt;chr&gt;, info.description &lt;chr&gt;, info.instruction &lt;chr&gt;, info.web &lt;chr&gt;,</span></span>
<span><span class="co">## #   info.area.areaDesc &lt;chr&gt;, Signature.SignedInfo.CanonicalizationMethod.Algorithm &lt;chr&gt;,</span></span>
<span><span class="co">## #   Signature.SignedInfo.SignatureMethod.Algorithm &lt;chr&gt;,</span></span>
<span><span class="co">## #   Signature.SignedInfo.Reference.Transforms.Transform.Algorithm &lt;chr&gt;, …</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="bulk-downloads">Bulk Downloads<a class="anchor" aria-label="anchor" href="#bulk-downloads"></a>
</h2>
<p>In some cases bulk downloading a full data set file may be preferred. For particularly large data requests, its usually faster to bulk download the entire data set as a csv file and then load it into the R environment. In this case, users can use the bulk_dl() command to download a csv of the full data file and save it to a specified directory.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bulk_dl.html">bulk_dl</a></span><span class="op">(</span><span class="st">"femaRegions"</span><span class="op">)</span> <span class="co"># download a csv file containing all info on FEMA regions</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>

  

  

  </body>
</html>
